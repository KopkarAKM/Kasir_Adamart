<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>AdaMart â€” Kasir & Stok</title>
  <link rel="icon" href="./assets/logo-monogram.svg" type="image/svg+xml"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>html,body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue','Noto Sans',sans-serif}</style>
  <!-- React & Router via CDN -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-router-dom@6/umd/react-router-dom.production.min.js"></script>
</head>
<body class="bg-white text-slate-800">
  <div id="root"></div>

  <script type="module">
    const React = window.React;
    const ReactDOM = window.ReactDOM;
    const { BrowserRouter, Routes, Route, Link, useNavigate } = window.ReactRouterDOM;

    const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbz_oK4iio9zkKwMbX9wiNvHAOlCcXhD0rBD0ovjz90RKMQZ0KXw8vQ7fuDdS1q19FJnLg/exec"; // ganti dengan milik Anda

    const IDR = new Intl.NumberFormat("id-ID", { style: "currency", currency: "IDR", minimumFractionDigits: 0 });
    const formatIDR = (n)=> IDR.format(Math.round(n||0));
    const nowISO = ()=> new Date().toISOString();
    const ls = { get:(k,d)=>{ try{return JSON.parse(localStorage.getItem(k))??d;}catch{return d;} }, set:(k,v)=>localStorage.setItem(k, JSON.stringify(v)) };

    async function callAPI(action, payload={}){
      const res = await fetch(GOOGLE_SCRIPT_URL, { method:"POST", mode:"cors", headers:{ "Content-Type":"text/plain;charset=utf-8" }, body: JSON.stringify({action,payload}) });
      if(!res.ok) throw new Error("HTTP "+res.status);
      const j = await res.json();
      if(j.status!=="success") throw new Error(j.message||"GAS error");
      return j.data;
    }

    const USERS = {
      Owner: { password: "0WnerPayBo55", role:"manager", area:"Kantor" },
      kasir1: { password: "password1", role:"staff", area:"Area Kasir 1" },
      kasir2: { password: "password2", role:"staff", area:"Area Kasir 2" },
      kasir3: { password: "password3", role:"staff", area:"Area Kasir 3" },
    };

    const initial = { user:null, products: ls.get("adamartProducts", {}), cart: [], sales: ls.get("adamartSales", []) };
    function reducer(state, action){
      switch(action.type){
        case "SET_USER": return {...state, user: action.user};
        case "SET_PRODUCTS": ls.set("adamartProducts", action.products||{}); return {...state, products: action.products||{}};
        case "ADD_TO_CART": {
          const p = state.products[action.barcode];
          if(!p || (p.stock||0)<=0) return state;
          const ex = state.cart.find(i=>i.barcode===action.barcode);
          const cart = ex ? state.cart.map(i=>i.barcode===action.barcode?{...i,quantity:i.quantity+1}:i) : [...state.cart, {...p, barcode: action.barcode, quantity:1}];
          return {...state, cart};
        }
        case "REMOVE_FROM_CART": return {...state, cart: state.cart.filter((_,i)=>i!==action.index)};
        case "RESET_CART": return {...state, cart: []};
        case "PUSH_SALE": { const sales=[...state.sales, action.sale]; ls.set("adamartSales", sales); return {...state, sales}; }
        case "PATCH_STOCK": {
          const next={...state.products}; action.items.forEach(it=>{ const cur=next[it.barcode]; if(cur) next[it.barcode]={...cur, stock:(cur.stock||0)-it.quantity}; });
          ls.set("adamartProducts", next); return {...state, products: next};
        }
        case "UPSERT_PRODUCT": {
          const { barcode, name, price, quantity } = action.payload;
          const next={...state.products}; const ex=next[barcode];
          next[barcode] = ex ? {...ex, name, price:Number(price), stock:(ex.stock||0)+Number(quantity)} : { name, price:Number(price), stock:Number(quantity) };
          ls.set("adamartProducts", next); return {...state, products: next};
        }
        case "LOGOUT": return {...initial, products: state.products, sales: state.sales};
      }
      return state;
    }

    function useToast(){
      const [t,setT] = React.useState(null);
      const show = (msg, kind="ok") => { setT({msg,kind}); setTimeout(()=>setT(null), 2800); };
      const El = t ? React.createElement("div",{className:"fixed top-5 right-5 z-50 rounded-lg px-4 py-3 text-white shadow "+(t.kind==="err"?"bg-red-500":"bg-green-500")}, t.msg) : null;
      return { show, El };
    }

    // --- Landing ---
    function Landing(){
      return React.createElement("div",{className:"bg-gradient-to-b from-slate-50 to-white min-h-screen"},[
        React.createElement("header",{className:"sticky top-0 bg-white/80 backdrop-blur"}, 
          React.createElement("nav",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between"},[
            React.createElement(Link,{to:"/", className:"flex items-center gap-2"},[
              React.createElement("img",{src:"./assets/logo-monogram.svg", className:"w-9 h-9 rounded-xl", alt:"Adamart"}),
              React.createElement("span",{className:"font-extrabold tracking-tight text-lg"},"AdaMart")
            ]),
            React.createElement("div",{className:"hidden md:flex items-center gap-6 text-sm font-medium"},[
              React.createElement("a",{href:"#fitur", className:"hover:text-blue-600"},"Fitur"),
              React.createElement("a",{href:"#harga", className:"hover:text-blue-600"},"Harga")
            ]),
            React.createElement("div",{className:"flex items-center gap-2"},[
              React.createElement("a",{href:"#", className:"hidden sm:inline-flex px-4 py-2 rounded-lg border"},"Lihat Demo"),
              React.createElement(Link,{to:"/app", className:"inline-flex px-4 py-2 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700"},"Buka Aplikasi")
            ])
          ])
        ),
        React.createElement("section",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-14 md:py-20 grid md:grid-cols-2 gap-10 items-center"},[
          React.createElement("div",{},[
            React.createElement("h1",{className:"text-4xl md:text-5xl font-extrabold leading-tight text-slate-900"},"Kasir Modern, Laporan Otomatis, Stok Terkontrol"),
            React.createElement("p",{className:"mt-4 text-lg text-slate-600 max-w-xl"},"Kelola transaksi, stok, dan laporan harian. Struk via WhatsApp, dukung QRIS, dashboard rapi."),
            React.createElement("div",{className:"mt-6 flex flex-wrap gap-3"},[
              React.createElement(Link,{to:"/app", className:"px-5 py-3 rounded-xl bg-blue-600 text-white font-semibold hover:bg-blue-700"},"Coba Sekarang"),
              React.createElement("a",{href:"#fitur", className:"px-5 py-3 rounded-xl border font-semibold"},"Lihat Fitur")
            ])
          ]),
          React.createElement("div",{className:"relative"},[
            React.createElement("div",{className:"rounded-2xl border bg-white p-4 shadow"},[
              React.createElement("div",{className:"grid md:grid-cols-2 gap-4"},[
                React.createElement("div",{},[
                  React.createElement("div",{className:"h-10 w-40 rounded-lg bg-slate-100 mb-3"}),
                  React.createElement("div",{className:"space-y-2"},[
                    React.createElement("div",{className:"h-9 rounded-lg bg-slate-100"}),
                    React.createElement("div",{className:"h-9 rounded-lg bg-slate-100"}),
                    React.createElement("div",{className:"h-9 rounded-lg bg-slate-100"}),
                  ]),
                  React.createElement("div",{className:"mt-4 h-10 rounded-lg bg-blue-600/90"})
                ]),
                React.createElement("div",{},[
                  React.createElement("div",{className:"h-6 w-28 rounded bg-slate-100 mb-2"}),
                  React.createElement("div",{className:"space-y-2 h-40 overflow-hidden"},[
                    React.createElement("div",{className:"h-10 rounded bg-slate-100"}),
                    React.createElement("div",{className:"h-10 rounded bg-slate-100"}),
                    React.createElement("div",{className:"h-10 rounded bg-slate-100"}),
                  ]),
                  React.createElement("div",{className:"mt-3 space-y-2"},[
                    React.createElement("div",{className:"h-6 rounded bg-slate-100"}),
                    React.createElement("div",{className:"h-6 rounded bg-slate-100"}),
                    React.createElement("div",{className:"h-8 rounded bg-blue-100"}),
                  ]),
                  React.createElement("div",{className:"grid grid-cols-2 gap-2 mt-4"},[
                    React.createElement("div",{className:"h-10 rounded bg-emerald-500"}),
                    React.createElement("div",{className:"h-10 rounded bg-violet-500"}),
                  ])
                ])
              ])
            ]),
            React.createElement("div",{className:"absolute -bottom-6 -left-6 bg-white rounded-xl px-4 py-3 border shadow"},[
              React.createElement("p",{className:"text-sm font-semibold"},"Struk via WhatsApp"),
              React.createElement("p",{className:"text-xs text-slate-500"},"Kirim otomatis setelah transaksi"),
            ])
          ])
        ]),
        React.createElement("section",{id:"fitur", className:"py-16"}, 
          React.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid sm:grid-cols-2 lg:grid-cols-4 gap-6"},
            [ "Kasir Cepat|Tambah barang, pajak 11%, total otomatis.",
              "Tunai & QRIS|Dua metode pembayaran populer.",
              "Struk WhatsApp|Kirim struk langsung ke WA pelanggan.",
              "Manajemen Stok|Tambah/update produk & stok."
            ].map((s,i)=>{
              const [t,d]=s.split("|");
              return React.createElement("div",{key:i, className:"p-6 rounded-2xl bg-white border hover:shadow"},[
                React.createElement("div",{className:"w-10 h-10 rounded-lg bg-blue-600 text-white grid place-items-center font-bold"}, String(i+1)),
                React.createElement("h3",{className:"mt-4 font-semibold"}, t),
                React.createElement("p",{className:"text-sm text-slate-600 mt-1"}, d),
              ])
            })
          )
        ),
        React.createElement("section",{id:"harga", className:"py-16 bg-slate-50"}, 
          React.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 grid md:grid-cols-3 gap-6"},[
            priceCard("Gratis","Rp 0",["POS dasar","Struk WhatsApp","Stok manual"],"/app",false),
            priceCard("Pro","Hubungi Kami",["Sinkron Google Sheet","Dashboard lengkap","Support prioritas"],"/app",true),
            priceCard("Enterprise","Konsultasi",["SSO/LDAP","Multi-cabang","Audit & SLA"],"/app",false),
          ])
        ),
        React.createElement("footer",{className:"py-10 border-t bg-white/60"},
          React.createElement("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-sm text-slate-500 flex items-center justify-between"},[
            React.createElement("p",{}, "Â© "+(new Date().getFullYear())+" AdaMart."),
            React.createElement("p",{}, "Didesain dengan Tailwind CSS")
          ])
        )
      ]);
    }

    function priceCard(title, price, items, to, highlight){
      return React.createElement("div",{className:"p-6 rounded-2xl bg-white border "+(highlight?"border-2 border-blue-600 shadow":"")},[
        React.createElement("h3",{className:"font-bold text-lg"}, title),
        React.createElement("div",{className:"mt-4 text-3xl font-extrabold"}, price),
        React.createElement("ul",{className:"mt-4 space-y-2 text-sm"}, items.map((it,i)=>React.createElement("li",{key:i},"â€¢ "+it))),
        React.createElement(Link,{to, className:"mt-6 inline-block px-4 py-2 rounded-lg font-semibold "+(highlight?"bg-blue-600 text-white":"bg-slate-900 text-white")}, highlight?"Coba Pro":"Pakai Paket Ini")
      ]);
    }

    // --- POS Sub App ---
    function Header({ user, onLogout, setView }){
      const isManager = user?.role === "manager";
      return React.createElement("header",{className:"bg-white p-4 rounded-xl shadow mb-6 flex justify-between items-center flex-wrap gap-2"},[
        React.createElement("div",{},[
          React.createElement("h1",{className:"text-2xl font-bold text-blue-600"},"AdaMart Kasir"),
          React.createElement("p",{className:"text-gray-500"},"Login sebagai: ", React.createElement("span",{className:"font-semibold"}, user?.name), " (", React.createElement("span",{className:"font-medium"}, user?.area||"Semua Area"), ")")
        ]),
        React.createElement("div",{className:"flex gap-2"},[
          isManager && React.createElement("button",{onClick:()=>setView("stock"), className:"bg-yellow-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-yellow-600"},"Stok"),
          React.createElement("button",{onClick:()=>setView("dashboard"), className:"bg-gray-200 text-gray-800 font-semibold py-2 px-4 rounded-md hover:bg-gray-300"},"Dashboard"),
          React.createElement("button",{onClick:onLogout, className:"bg-red-500 text-white font-semibold py-2 px-4 rounded-md hover:bg-red-600"},"Logout"),
        ])
      ]);
    }

    function Login({ onLogin, onLoadProducts, busy }){
      const [u,setU]=React.useState(""); const [p,setP]=React.useState(""); const [err,setErr]=React.useState("");
      const nav = useNavigate();
      React.useEffect(()=>{ onLoadProducts(); },[]);
      const doLogin=()=>{ const user=USERS[u]; if(!user||user.password!==p) return setErr("Username atau password salah."); setErr(""); onLogin({name:u,...user}); nav("/app"); };
      return React.createElement("div",{className:"min-h-[70vh] flex items-center justify-center"},
        React.createElement("div",{className:"relative bg-white w-full max-w-sm p-8 rounded-xl shadow"},[
          busy && React.createElement("div",{className:"absolute inset-0 bg-white/80 rounded-xl grid place-items-center"}, React.createElement("div",{className:"w-8 h-8 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin"})),
          React.createElement("h2",{className:"text-3xl font-bold text-center text-blue-600 mb-1"},"AdaMart"),
          React.createElement("p",{className:"text-center text-gray-500 mb-6"},"Masuk untuk memulai"),
          React.createElement("label",{className:"block text-sm font-medium"},"Username"),
          React.createElement("input",{value:u, onChange:e=>setU(e.target.value), className:"mt-1 mb-3 w-full rounded-md border px-3 py-2", placeholder:"Owner / kasir1 / kasir2"}),
          React.createElement("label",{className:"block text-sm font-medium"},"Password"),
          React.createElement("input",{type:"password", value:p, onChange:e=>setP(e.target.value), className:"mt-1 w-full rounded-md border px-3 py-2", placeholder:"Password Anda"}),
          err && React.createElement("p",{className:"text-red-500 text-sm mt-2 text-center"}, err),
          React.createElement("button",{onClick:doLogin, className:"w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 rounded-md"},"Login")
        ])
      );
    }

    function POS({ products, addToCart, cart, removeFromCart, totals, openPay }){
      const [sel,setSel]=React.useState(""); const has=Object.keys(products).length>0;
      return React.createElement("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6"},[
        React.createElement("div",{className:"bg-white p-6 rounded-xl shadow space-y-4 lg:col-span-1"},[
          React.createElement("h2",{className:"text-xl font-semibold mb-3"},"Pilih Produk"),
          React.createElement("div",{className:"flex items-center gap-2"},[
            React.createElement("select",{className:"w-full rounded-md border px-3 py-2", value:sel, onChange:e=>setSel(e.target.value), disabled:!has},[
              React.createElement("option",{value:""},"-- Pilih Produk --"),
              ...Object.entries(products).map(([bc,p])=> React.createElement("option",{key:bc, value:bc}, `${p.name} (Stok: ${p.stock||0})`))
            ]),
            React.createElement("button",{onClick:()=>{ if(sel){ addToCart(sel); setSel(""); } }, className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-md hover:bg-blue-700", disabled:!sel},"Tambah")
          ])
        ]),
        React.createElement("div",{className:"bg-white p-6 rounded-xl shadow flex flex-col lg:col-span-2"},[
          React.createElement("h2",{className:"text-2xl font-bold mb-4"},"Keranjang Belanja"),
          React.createElement("div",{className:"flex-grow space-y-3 overflow-y-auto max-h-96 pr-2"},
            cart.length===0 ? React.createElement("p",{className:"text-gray-500 text-center py-10"},"Keranjang masih kosong.") :
            cart.map((it,idx)=> React.createElement("div",{key:idx, className:"flex items-center justify-between p-2 bg-gray-50 rounded-md"},[
              React.createElement("div",{},[
                React.createElement("p",{className:"font-semibold"}, it.name),
                React.createElement("p",{className:"text-sm text-gray-500"}, `${formatIDR(it.price)} Ã— ${it.quantity}`),
              ]),
              React.createElement("div",{className:"flex items-center gap-3"},[
                React.createElement("span",{className:"font-bold w-24 text-right"}, formatIDR(it.price*it.quantity)),
                React.createElement("button",{onClick:()=>removeFromCart(idx), className:"text-red-500 hover:text-red-700 font-bold"}, "X")
              ])
            ]))
          ),
          React.createElement("div",{className:"border-t pt-4 mt-4"},[
            React.createElement("div",{className:"space-y-1 text-lg"},[
              React.createElement("div",{className:"flex justify-between"},[React.createElement("span",null,"Subtotal"), React.createElement("span",null, formatIDR(totals.subtotal))]),
              React.createElement("div",{className:"flex justify-between"},[React.createElement("span",null,"Pajak (11%)"), React.createElement("span",null, formatIDR(totals.tax))]),
              React.createElement("div",{className:"flex justify-between font-bold text-2xl text-blue-600"},[React.createElement("span",null,"Total"), React.createElement("span",null, formatIDR(totals.total))]),
            ]),
            React.createElement("div",{className:"grid grid-cols-2 gap-4 mt-6"},[
              React.createElement("button",{onClick:()=>openPay("Tunai"), className:"bg-green-500 text-white font-bold py-3 rounded-md hover:bg-green-600", disabled:cart.length===0},"Bayar Tunai"),
              React.createElement("button",{onClick:()=>openPay("QRIS"), className:"bg-purple-500 text-white font-bold py-3 rounded-md hover:bg-purple-600", disabled:cart.length===0},"Bayar QRIS"),
            ])
          ])
        ])
      ]);
    }

    function Dashboard({ sales }){
      const [area,setArea]=React.useState("Semua Area");
      const areas = React.useMemo(()=>Array.from(new Set(sales.map(s=>s.area).filter(Boolean))),[sales]);
      const filtered = React.useMemo(()=> area==="Semua Area"? sales : sales.filter(s=>s.area===area), [area, sales]);
      const totalRevenue = filtered.reduce((a,s)=>a+s.total,0);
      const totalTx = filtered.length;
      const counts={}; filtered.forEach(s=>s.items.forEach(i=>counts[i.name]=(counts[i.name]||0)+i.quantity));
      const top = Object.keys(counts).length? Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0] : "-";
      return React.createElement("div",{},[
        React.createElement("header",{className:"bg-white p-4 rounded-xl shadow mb-6 flex justify-between items-center"},[
          React.createElement("h1",{className:"text-2xl font-bold text-blue-600"},"Dashboard Penjualan"),
          React.createElement("div",{className:"flex items-center gap-3"},[
            React.createElement("label",{className:"text-sm"},"Filter Area:"),
            React.createElement("select",{value:area, onChange:e=>setArea(e.target.value), className:"rounded-md border px-2 py-1"},[
              React.createElement("option",null,"Semua Area"),
              ...areas.map(a=>React.createElement("option",{key:a},a))
            ])
          ])
        ]),
        React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6"},[
          React.createElement("div",{className:"bg-white p-6 rounded-xl shadow"},[React.createElement("h3",{className:"text-gray-500"},"Total Pendapatan"), React.createElement("p",{className:"text-3xl font-bold text-green-600"}, formatIDR(totalRevenue))]),
          React.createElement("div",{className:"bg-white p-6 rounded-xl shadow"},[React.createElement("h3",{className:"text-gray-500"},"Total Transaksi"), React.createElement("p",{className:"text-3xl font-bold text-blue-600"}, totalTx)]),
          React.createElement("div",{className:"bg-white p-6 rounded-xl shadow"},[React.createElement("h3",{className:"text-gray-500"},"Produk Terlaris"), React.createElement("p",{className:"text-3xl font-bold text-purple-600"}, top)]),
        ]),
        React.createElement("div",{className:"bg-white p-6 rounded-xl shadow overflow-x-auto"},[
          React.createElement("h2",{className:"text-xl font-bold mb-4"},"Riwayat Transaksi"),
          React.createElement("table",{className:"min-w-full divide-y"},[
            React.createElement("thead",{className:"bg-gray-50"}, React.createElement("tr",null,[
              React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Waktu"),
              React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Area"),
              React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Total"),
              React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Pembayaran"),
              React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Item"),
            ])),
            React.createElement("tbody",{className:"divide-y"}, [...filtered].reverse().map((s,i)=>React.createElement("tr",{key:i},[
              React.createElement("td",{className:"px-6 py-3 text-sm"}, new Date(s.timestamp).toLocaleString("id-ID")),
              React.createElement("td",{className:"px-6 py-3 text-sm"}, s.area||"N/A"),
              React.createElement("td",{className:"px-6 py-3 text-sm font-semibold"}, formatIDR(s.total)),
              React.createElement("td",{className:"px-6 py-3 text-sm"}, s.paymentMethod),
              React.createElement("td",{className:"px-6 py-3 text-sm text-gray-600"}, s.items.map(i=>`${i.name} (x${i.quantity})`).join(", ")),
            ])))
          ])
        ])
      ]);
    }

    function Stock({ products, onSubmit }){
      const [bc,setBc]=React.useState(""); const [nm,setNm]=React.useState(""); const [pr,setPr]=React.useState(""); const [qt,setQt]=React.useState(""); const [busy,setBusy]=React.useState(false);
      React.useEffect(()=>{ const p=products[bc]; if(p){ setNm(p.name); setPr(p.price); } },[bc,products]);
      const submit=async e=>{ e.preventDefault(); setBusy(true); try{ await onSubmit({ barcode:bc, name:nm, price:Number(pr), quantity:Number(qt) }); setBc(""); setNm(""); setPr(""); setQt(""); } finally { setBusy(false); } };
      return React.createElement("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6"},[
        React.createElement("div",{className:"md:col-span-2 bg-white p-6 rounded-xl shadow"},[
          React.createElement("h2",{className:"text-xl font-bold mb-4"},"Daftar Produk"),
          React.createElement("div",{className:"overflow-x-auto max-h-[60vh]"},
            React.createElement("table",{className:"min-w-full divide-y"},[
              React.createElement("thead",{className:"bg-gray-50 sticky top-0"}, React.createElement("tr",null,[
                React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Barcode"),
                React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Nama Produk"),
                React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Harga"),
                React.createElement("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"Stok"),
              ])),
              React.createElement("tbody",{className:"divide-y"}, Object.entries(products).map(([k,p])=>
                React.createElement("tr",{key:k, className:"text-sm"},[
                  React.createElement("td",{className:"px-6 py-3 font-mono"}, k),
                  React.createElement("td",{className:"px-6 py-3 font-semibold"}, p.name),
                  React.createElement("td",{className:"px-6 py-3"}, formatIDR(p.price)),
                  React.createElement("td",{className:"px-6 py-3 font-bold "+(((p.stock||0)<10)?"text-red-500":"text-green-600")}, p.stock||0),
                ])
              ))
            ])
          )
        ]),
        React.createElement("div",{className:"bg-white p-6 rounded-xl shadow"},[
          React.createElement("h2",{className:"text-xl font-bold mb-4"},"Tambah Stok / Produk Baru"),
          React.createElement("form",{onSubmit:submit, className:"space-y-3"},[
            React.createElement("div",{},[React.createElement("label",{className:"block text-sm font-medium"},"Barcode"), React.createElement("input",{required:true, value:bc, onChange:e=>setBc(e.target.value), className:"mt-1 w-full rounded-md border px-3 py-2"})]),
            React.createElement("div",{},[React.createElement("label",{className:"block text-sm font-medium"},"Nama Produk"), React.createElement("input",{required:true, value:nm, onChange:e=>setNm(e.target.value), className:"mt-1 w-full rounded-md border px-3 py-2"})]),
            React.createElement("div",{},[React.createElement("label",{className:"block text-sm font-medium"},"Harga Jual"), React.createElement("input",{type:"number", required:true, value:pr, onChange:e=>setPr(e.target.value), className:"mt-1 w-full rounded-md border px-3 py-2"})]),
            React.createElement("div",{},[React.createElement("label",{className:"block text-sm font-medium"},"Jumlah Masuk"), React.createElement("input",{type:"number", min:1, required:true, value:qt, onChange:e=>setQt(e.target.value), className:"mt-1 w-full rounded-md border px-3 py-2"})]),
            React.createElement("button",{disabled:busy, className:"w-full bg-blue-600 text-white font-bold py-2 rounded-md hover:bg-blue-700"}, busy?"Menyimpanâ€¦":"Simpan")
          ])
        ])
      ]);
    }

    function PaymentModal({ open, method, totals, onClose, onConfirm }){
      const [amount,setAmount]=React.useState(""); const change=Math.max(0,(Number(amount)||0)-totals.total);
      React.useEffect(()=>{ if(open) setAmount(""); },[open]); if(!open) return null;
      return React.createElement("div",{className:"fixed inset-0 z-40 bg-black/50 flex items-center justify-center p-4"},
        React.createElement("div",{className:"bg-white rounded-xl p-6 w-full max-w-md"},[
          React.createElement("h2",{className:"text-2xl font-bold text-center mb-4"}, method==="Tunai"?"Pembayaran Tunai":"Pembayaran QRIS"),
          method==="Tunai" ? React.createElement("div",{className:"space-y-3"},[
            React.createElement("div",{},[React.createElement("p",{className:"text-sm text-gray-600"},"Total Belanja"), React.createElement("p",{className:"text-2xl font-semibold"}, formatIDR(totals.total))]),
            React.createElement("div",{},[React.createElement("label",{className:"block text-sm font-medium"},"Jumlah Uang"), React.createElement("input",{type:"number", value:amount, onChange:e=>setAmount(e.target.value), className:"mt-1 w-full rounded-md border px-3 py-2", placeholder:"Masukkan jumlah uang tunai"})]),
            React.createElement("div",{},[React.createElement("p",{className:"text-sm text-gray-600"},"Kembalian"), React.createElement("p",{className:"text-2xl font-bold text-green-600"}, formatIDR(change))]),
            React.createElement("button",{disabled:(Number(amount)||0)<totals.total, onClick:onConfirm, className:"w-full bg-blue-600 disabled:bg-gray-400 text-white font-bold py-2 rounded-md"},"Konfirmasi")
          ]) : React.createElement("div",{className:"text-center space-y-3"},[
            React.createElement("p",null,"Scan kode QRIS di bawah ini."),
            React.createElement("div",{className:"mx-auto w-64 h-64 rounded-lg bg-gray-100 grid place-items-center shadow"}, React.createElement("span",{className:"text-gray-400"},"QRIS Anda")),
            React.createElement("p",{className:"font-bold text-2xl"},"Total: "+formatIDR(totals.total)),
            React.createElement("button",{onClick:onConfirm, className:"w-full bg-blue-600 text-white font-bold py-2 rounded-md"},"Saya Sudah Bayar")
          ]),
          React.createElement("button",{onClick:onClose, className:"w-full mt-3 bg-gray-200 text-gray-800 font-bold py-2 rounded-md"},"Batal")
        ])
      );
    }

    function ReceiptModal({ open, tx, onClose }){
      if(!open||!tx) return null;
      const lines=[]; lines.push("      *** AdaMart ***"); lines.push("--------------------------------"); lines.push("Waktu: "+new Date(tx.timestamp).toLocaleString("id-ID")); lines.push("Area : "+tx.area); lines.push("");
      tx.items.forEach(it=>{ const line=it.name+"\n  "+it.quantity+" x "+formatIDR(it.price); const tot=formatIDR(it.price*it.quantity); lines.push(line.padEnd(32," ")+tot); });
      lines.push("--------------------------------"); lines.push("Subtotal           : "+formatIDR(tx.subtotal)); lines.push("Pajak (11%)        : "+formatIDR(tx.tax)); lines.push("TOTAL              : "+formatIDR(tx.total)); lines.push(""); lines.push("Metode Bayar: "+tx.paymentMethod); lines.push(""); lines.push("   Terima Kasih!");
      const receipt = lines.join("\n");
      const wa = "https://wa.me/?text="+encodeURIComponent("Halo, ini struk belanja Anda di AdaMart:\n\n"+receipt);
      return React.createElement("div",{className:"fixed inset-0 z-40 bg-black/50 flex items-center justify-center p-4"},
        React.createElement("div",{className:"bg-white rounded-xl p-6 w-full max-w-md"},[
          React.createElement("h2",{className:"text-2xl font-bold mb-3 text-center"},"Transaksi Berhasil"),
          React.createElement("pre",{className:"bg-gray-50 p-4 rounded-md text-sm whitespace-pre-wrap overflow-x-auto"}, receipt),
          React.createElement("div",{className:"mt-4 space-y-2"},[
            React.createElement("a",{href:wa, target:"_blank", rel:"noreferrer", className:"block text-center bg-green-500 hover:bg-green-600 text-white font-bold py-2 rounded-md"},"Kirim Struk ke WhatsApp"),
            React.createElement("button",{onClick:onClose, className:"w-full bg-blue-600 text-white font-bold py-2 rounded-md"},"Selesai (Transaksi Baru)")
          ])
        ])
      );
    }

    function AppPOS(){
      const [state, dispatch] = React.useReducer(reducer, initial);
      const { show, El:Toast } = useToast();
      const [busy, setBusy] = React.useState(false);
      const [payOpen,setPayOpen]=React.useState(false); const [payMethod,setPayMethod]=React.useState("Tunai"); const [receipt,setReceipt]=React.useState({open:false,tx:null});
      const [view,setView]=React.useState("login");

      const totals = React.useMemo(()=>{ const subtotal=state.cart.reduce((s,it)=>s+it.price*it.quantity,0); const tax=subtotal*0.11; const total=subtotal+tax; return {subtotal,tax,total}; },[state.cart]);

      const loadProducts = async ()=>{ try{ setBusy(true); const data=await callAPI("get_products"); dispatch({type:"SET_PRODUCTS", products:data||{}}); show("Data produk berhasil dimuat!"); }catch(e){ console.error(e); show("Gagal memuat data Sheet. Memakai data lokal.","err"); } finally { setBusy(false);} };
      const finalize = async ()=>{ const tx={ timestamp: nowISO(), items: state.cart, subtotal: totals.subtotal, tax: totals.tax, total: totals.total, paymentMethod: payMethod, area: state.user?.area||"N/A" }; try{ await callAPI("record_sale", tx); dispatch({type:"PUSH_SALE", sale:tx}); dispatch({type:"PATCH_STOCK", items: state.cart}); setPayOpen(false); dispatch({type:"RESET_CART"}); setReceipt({open:true,tx}); }catch(e){ console.error(e); show("Gagal mencatat penjualan. Coba lagi.","err"); } };
      const upsert = async (payload)=>{ try{ await callAPI("update_stock", payload); dispatch({type:"UPSERT_PRODUCT", payload}); show("Stok berhasil diperbarui!"); }catch(e){ console.error(e); show("Gagal memperbarui stok. Coba lagi.","err"); } };
      const addToCart = (bc)=>{ const p=state.products[bc]; if(!p) return show("Produk tidak ditemukan!","err"); if((p.stock||0)<=0) return show("Stok "+p.name+" habis!","err"); dispatch({type:"ADD_TO_CART", barcode:bc}); show(p.name+" ditambahkan!"); };

      if(!state.user) return React.createElement(Login,{ onLogin:(user)=>{dispatch({type:"SET_USER", user}); setView("pos");}, onLoadProducts:loadProducts, busy });

      return React.createElement("div",{className:"bg-gray-100 min-h-screen"},[
        React.createElement("div",{className:"w-full max-w-7xl mx-auto p-4"},[
          React.createElement(Header,{ user:state.user, onLogout:()=>dispatch({type:"LOGOUT"}), setView }),
          view==="pos" && React.createElement(POS,{ products:state.products, addToCart, cart:state.cart, removeFromCart:(i)=>dispatch({type:"REMOVE_FROM_CART", index:i}), totals, openPay:(m)=>{setPayMethod(m); setPayOpen(true);} }),
          view==="dashboard" && React.createElement(Dashboard,{ sales:state.sales}),
          view==="stock" && React.createElement(Stock,{ products:state.products, onSubmit:upsert }),
        ]),
        React.createElement(PaymentModal,{ open:payOpen, method:payMethod, totals, onClose:()=>setPayOpen(false), onConfirm:finalize }),
        React.createElement(ReceiptModal,{ open:receipt.open, tx:receipt.tx, onClose:()=>setReceipt({open:false,tx:null}) }),
        Toast
      ]);
    }

    function App(){
      return React.createElement(BrowserRouter,null,
        React.createElement(Routes,null,[
          React.createElement(Route,{path:"/", element: React.createElement(Landing)}),
          React.createElement(Route,{path:"/app", element: React.createElement(AppPOS)}),
        ])
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(React.createElement(App));
  </script>
</body>
</html>
